---
title: "Intervalos de confianza y test de hipótesis para poblaciones no-normales"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Datos no-normales
### Fútbol y Poisson
Bajo ciertas condiciones, el número de goles marcados en un partido de fútbol 
se puede aproximar por una distribución de Poisson. El fichero "spain_league.csv"
contiene datos sobre la liga de fútbol española. Para hacer tus apuestas deportivas,
es importante saber el número de goles promedio por equipo en cada partido. Usando
los resultados de la liga 21-22, construye un intervalo de confianza
del 98\% para el promedio de goles del equipo local en un partido.

  X: numero de goles en u partido
  X ~ P(lambda)
  donde lambda es el numero medio de goles en un partido por equipo
  
  lambda = E[X] ---> mean()
  Teorema central del limite: X1, X2, ..., Xn --> deben ser independientes
  la suma de todos esos datos es aprox una normal
    E[X1 + X2 + ... + Xn] = E[X1] + ... E[Xn] = n * lambda
    Var[X1 + X2 + ... + Xn] = (si son independientes) = Var[X1] + ... + Var[Xn] = n * lambda
    X1 + ... + Xn ~ Normal(n * lambda, varianza = n * lambda)
    media muestral = (X1 + ... + Xn) / n ~ Normal(lambda, varianza = lambda / n)
    
```{r}
library("tidyverse")
library("effectsize")
library(readr)
spain_league <- read_csv("C:/Users/machi/Downloads/CEU/segundo año/estadistica/data_4/data_4/spain_league.csv")
View(spain_league)

spain_2021 = spain_league[spain_league$Season == 2021, ]
# pq no usar tmb vgoal? para evitar dependencias
goles_local = spain_2021$hgoal

lambda_est = mean(goles_local)
lambda_est

# cuantiles:
# paso 3.-
  zs = c(
    qnorm(0.01),
    qnorm(0.99)
  )  
lambda_est + zs * sqrt(lambda_est / length(goles_local))  # 1.278791 - 1.563314

# EJERCICIO INTERESANTE: calcular usando table la dist. de goles y comprobar usando 
  # dpois, q poisson es una buena aproximacion



        # paso 4.- IC
        # despejar lambda
        # si aparece en numerador y denominador sustituir el del denominador por la media
  

```


# Datos tabulares
## Racismo en la selección de jurados
Durante los 60s-70s, se dieron casos de racismo en la elección de jurados
populares. Supuestamente, la elección es al azar entre un listado de todos los
ciudadanos. Sin embargo, se daban situaciones como que en una preselección de 80
posibles jurados solo 4 fuesen afroamericanos (de una población con un 50\% de
afroamericanos). Datos en "juries.csv". Las autoridades se defendían diciendo
que era pura casualidad. ¿Es esto creíble? Apoya tus conclusiones con gráficos.

X: nº de afroameriacnos en la preseleccion del jurado (discreta)
x ~ B(80, p) siendo p la prob de exito

Ha: p < 0.5
H0: p = 0.5

```{r}
prop.test(4, 80, alternative = "less", p = 0.5)


```
el p_valor es casi 0 de donde los datos apoyan abrumadoramente q la prob de seleccion de 
un afroamericano es menos q 0.5. (******** racistas). Usando un IC al 95%, la prob de selccion de 
un afroamericano es menor al 11%

### A/B testing
Una página web de venta de productos ha estudiado el número de conversiones de
su página web actual (conversión $=$ el usuario hace click en ``comprar ahora'').
Para aumentar el número de conversiones, rediseña el aspecto de su página web en
base a *heatmaps*.  La nueva página se prueba con un nuevo conjunto de usuarios,
midiendo el número de conversiones. Datos en "ab_testing.csv". ¿Se puede 
concluir que la nueva página incrementa el número de conversiones? 
Apoya tus conclusiones con un gráfico.

N: nº de clck d ela pagina nueva
V: nº de clck d ela pagina vieja

N ~ B(n_nueva, p_nueva)
V ~ B(n_vieja, p_vieja)

Ha: nº de clicks nueva > nº clicks vieja
    p_nueva < p_vieja

```{r}
library(readr)
ab_testing <- read_csv("C:/Users/machi/Downloads/CEU/segundo año/estadistica/data_4/data_4/ab_testing.csv")
# View(ab_testing)

ab_old = ab_testing[ab_testing$page_design == "old", ]
old = table(ab_old$has_clicked)
ab_new = ab_testing[ab_testing$page_design == "new", ]
new = table(ab_new$has_clicked)
click_0 = old[1] - new[1]
click_1 = old[2] - new[2]
click_0 + click_1

## OTRA FORMA
  counts = table(ab_testing)
  rowSums(counts)
  
  prop.test(c(287, 192), c(1109, 1012), alternative = "greater")
  # hacerlo sin poner los numeros a machete --> counts[...]
  
```
La prob de hacer click a la nueva pagina es por lo menos un 3% mayor a la 
pagina vieja. (intervalo del 95% de confianza). Debdemos cambiar el diseño.

Dado q el p_valor es muy pequeño, existe una gran evidencia de q la prob en nueva 
sea mayor q vieja
